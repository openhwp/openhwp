# OpenHWP Office Design Decisions

설계 결정 사항을 요약합니다. 상세 내용은 [DESIGN.md](./DESIGN.md)를 참조하세요.

---

## 아키텍처

| 결정 | 선택 | 이유 |
|------|------|------|
| IR과 편집 모델 분리 | **별도 document 크레이트** | IR은 파일 호환, document는 편집 최적화 |
| 렌더링 추상화 | **trait 기반 백엔드 분리** | 웹/네이티브 동시 지원 |
| 이벤트 루프 | **순수 함수 코어 + 플랫폼 어댑터** | 결정론적 동작, 테스트 용이 |

---

## 문서 모델

| 결정 | 선택 | 이유 |
|------|------|------|
| 텍스트 저장 | **블록 리스트 + String** | 90% 문단이 500자 미만, String이 효율적 |
| 스타일 관리 | **상속 없이 명시적 지정** | 구현 단순, 디버깅 용이 |
| 스타일 중복 방지 | **인터닝 (동일 스타일 공유)** | 메모리 효율 |
| 편집 연산 | **Command 패턴** | Undo/Redo, 향후 협업 대비 |
| 복사/붙여넣기 | **스타일 정의 포함 복사** | 붙여넣기 시 병합 |

---

## 레이아웃

| 결정 | 선택 | 이유 |
|------|------|------|
| 캐싱 전략 | **dirty 플래그** | 업계 표준 방식 |
| 줄바꿈 | **HWP/HWPX 규칙 구현** | 파일 포맷 호환 |
| 글꼴 대체 | **아래아한글 알고리즘 준수** | 렌더링 일관성 |
| 텍스트 셰이핑 | **하이브리드 (단순 + 정밀)** | MVP는 단순, 필요시 rustybuzz |

---

## 플랫폼

| 결정 | 선택 | 이유 |
|------|------|------|
| 플랫폼 우선순위 | **웹 우선 → Tauri 데스크톱** | 단일 코드베이스 |
| IME 통합 | **숨겨진 textarea** | OS IME 활용, 한글 완벽 지원 |
| 웹 렌더링 | **Canvas 2D** | 직접 제어 가능 |
| 성능 목표 | **60fps** | 사용자 경험 |

---

## 범위

| 항목 | 상태 | 비고 |
|------|------|------|
| 협업 편집 | 추후 | Command 패턴으로 확장 대비 |
| 플러그인 | 추후 | 기본 기능 집중 |
| 모바일 | 낮은 우선순위 | 데스크톱 해상도 우선 |
| 접근성 | 적절히 고려 | 초기부터 설계에 반영 |

---

## 구현 순서

1. Document 모델 (블록 + TextStorage)
2. Selection 모델
3. 기본 편집 (insert, delete)
4. Command/History (Undo/Redo)
5. 레이아웃 엔진 (텍스트 측정, 줄바꿈)
6. 렌더링 (Canvas)
7. 입력 처리 (키보드, 마우스)
8. IME 통합
9. 복사/붙여넣기
10. 스타일 편집 UI
